import{_ as O}from"./index.95fe1fa6.js";import{u as S}from"./hooks.32207597.js";import{a as k}from"./hooks.fa6cbc3c.js";import{a as o,w as z,c as I,f as V,i as j,G as s,o as G}from"./index.a364b306.js";import"./menu.fa185c44.js";const M={name:"AllTags"},J=Object.assign(M,{setup(N){const{loading:w,pagination:n,getPageTag:_,addTag:y,updateTag:T,deleteTag:b,batchDeleteTag:A}=k(),p=S(),v=o([]),r=async()=>{try{const{data:e,error:a,msg:u}=await _({offset:(n.page-1)*n.size,limit:n.size});if(a)return;v.value=e.list,n.page=e.page,n.total=e.total}catch(e){console.log(e)}};z(async()=>{await r()}),s("data",v),s("pagination",n),s("loading",w);const l=o(""),f=o(!1),t=o([]),c=o(!1),D=(e,a)=>{const u=t.value.findIndex(d=>d.id===a.id);u>=0?t.value.splice(u,1):t.value.push(a),c.value=v.value.every(d=>t.value.includes(d))},U=()=>{c.value=!c.value,c.value?t.value=v.value.map(e=>e):t.value=[]},i=o(!1),g=()=>{i.value=!i.value,i.value||(c.value=!1,t.value=[])},x=()=>{p.show({title:"\u786E\u5B9A\u5220\u9664\u5168\u90E8\u9009\u4E2D\uFF1F",message:"\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D",showCancel:!0,onEnter:async()=>{try{const e=t.value.map(d=>d.id),{error:a,msg:u}=await A({ids:e});if(a)return;g(),await r()}catch(e){console.log(e)}}})},B=e=>{p.show({title:"\u786E\u5B9A\u5220\u9664\uFF1F",message:"\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D",showCancel:!0,onEnter:async()=>{try{const{error:a,msg:u}=await b(e.id);if(a)return;await r()}catch(a){console.log(a)}}})},m=o(null),E=e=>{i.value&&g(),f.value=!0,m.value=e,l.value=e.name},C=async()=>{if(f.value){if(!l.value.trim())return;try{const{error:e,msg:a}=await T(m.value.id,{name:l.value});if(e)return;await r(),h()}catch(e){console.log(e)}}else{if(!l.value.trim())return;try{const{error:e,msg:a}=await y({name:l.value});if(e)return;await r()}catch(e){console.log(e)}l.value=""}},h=()=>{f.value=!1,l.value=""};return s("batch",{isBatch:i,toggleBatch:g,batchDelete:x}),s("selected",{selectedData:t,setSelected:D}),s("selectAll",{isSelectAll:c,toggleSelectAll:U}),s("buttonOperation",{onDelete:B,onUpdate:E}),s("input",{inputValue:l,isUpdate:f,onAddOrUpdate:C,onCancelUpdate:h}),(e,a)=>(G(),I("div",null,[V(j(O))]))}});export{J as default};
