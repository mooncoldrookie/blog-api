import{d as O,s as A,a as E,g as H}from"./post.e569fe0c.js";import{u as C}from"./hooks.32207597.js";import{r as B,a as j,S as L,x as z,o as _,j as I,g as h,b as e,f as d,i as a,n as D,t as x,$ as N,_ as R,I as V,Z as P,c as $,e as S,M,p as F,k as U,w as G,F as Z,v as q,l as J,G as K}from"./index.a364b306.js";import{m as Q,p as W,v as T,f as X}from"./menu.fa185c44.js";function tt(){const t=B({page:1,size:10,total:0}),i=j([]),l=j(!1),v=C();async function b(){let s,n,r;try{l.value=!0,s=(await H({offset:(t.page-1)*t.size,limit:t.size})).data}catch(c){n=!0,s=c.data,r=c.data.msg||c.statusText}finally{l.value=!1}return{data:s,error:n,msg:r}}async function o(){try{const{data:s,error:n,msg:r}=await b();if(n){v.show({title:"\u83B7\u53D6\u6587\u7AE0\u51FA\u9519",message:r});return}i.value=s.list,t.total=s.total,t.page=s.page}catch(s){console.log(s)}}async function g(s){let n,r;try{l.value=!0,await O(s)}catch(c){n=!0,r=c.data.msg||c.statusText}finally{l.value=!1}return{error:n,msg:r}}async function u(s){let n,r,c;try{l.value=!0,n=(await A(s)).data}catch(f){r=!0,n=f.data,c=f.data.msg||f.statusText}finally{l.value=!1}return{data:n,error:r,msg:c}}async function p(s){let n,r,c;try{l.value=!0,n=(await E(s)).data}catch(f){r=!0,n=f.data,c=f.data.msg||f.statusText}finally{l.value=!1}return{data:n,error:r,msg:c}}return{pagination:t,loading:l,postList:i,fetchPostList:o,deletePost:g,setPostTop:u,setPostStatus:p}}const et=e("span",{class:"ml-2"},"\u64CD\u4F5C",-1),st={class:"px-1 py-1"},at={class:"ml-2"},nt={class:"px-1 py-1"},ot={class:"ml-2"},it={class:"px-1 py-1"},lt=e("span",{class:"ml-2"},"\u5220\u9664",-1),rt={name:"ButtonDropdownMenu"},ct=Object.assign(rt,{props:{item:Object},setup(t){const{onDelete:i,onSetTop:l,onSetStatus:v}=L("events");return(b,o)=>{const g=z("m-icon");return _(),I(a(X),{as:"div",class:"relative inline-block text-left"},{default:h(()=>[e("div",null,[d(a(Q),{class:"inline-flex w-full items-center justify-center rounded border px-3 py-[6px] hover:bg-gray-50 focus:outline-none"},{default:h(()=>[d(g,{icon:"angle-down",class:"h-5 w-5 text-violet-200 hover:text-violet-100","aria-hidden":"true"}),et]),_:1})]),d(N,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:h(()=>[d(a(W),{class:"absolute right-0 z-[1] mt-2 w-36 origin-top-right divide-y divide-gray-100 rounded-md bg-gray-50 shadow"},{default:h(()=>[e("div",st,[d(a(T),null,{default:h(({active:u})=>[e("button",{onClick:o[0]||(o[0]=p=>a(l)(t.item)),class:D([u?"bg-cyan-500 text-white":"text-black","group flex w-full items-center rounded-md px-2 py-2 text-sm"])},[d(g,{icon:t.item.top?"down-from-line":"up-to-line",active:u,class:"mr-2 h-5 w-5","aria-hidden":"true"},null,8,["icon","active"]),e("span",at,x(t.item.top?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876"),1)],2)]),_:1})]),e("div",nt,[d(a(T),null,{default:h(({active:u})=>[e("button",{onClick:o[1]||(o[1]=p=>a(v)(t.item)),class:D([u?"bg-cyan-500 text-white":"text-black","group flex w-full items-center rounded-md px-2 py-2 text-sm"])},[d(g,{icon:t.item.status===0?"paper-plane-top":"do-not-enter",active:u,class:"mr-2 h-5 w-5","aria-hidden":"true"},null,8,["icon","active"]),e("span",ot,x(t.item.status===0?"\u53D1\u5E03":"\u9690\u85CF"),1)],2)]),_:1})]),e("div",it,[d(a(T),null,{default:h(({active:u})=>[e("button",{onClick:o[2]||(o[2]=p=>a(i)(t.item)),class:D([u?"bg-cyan-500 text-white":"text-black","group flex w-full items-center rounded-md px-2 py-2 text-sm text-rose-500"])},[d(g,{icon:"trash-can",active:u,class:"mr-2 h-5 w-5","aria-hidden":"true"},null,8,["active"]),lt],2)]),_:1})])]),_:1})]),_:1})]),_:1})}}});const Y=t=>(F("data-v-19fe9c72"),t=t(),U(),t),dt={class:"post-item-container border-b"},ut={class:"post-item-wrapper mx-2 py-4"},mt={class:"flex items-center justify-between"},pt={class:"flex w-[700px] items-center"},ft={class:"rounded bg-blue-100 p-1 text-sm text-blue-800"},vt={class:"ml-3 text-lg font-medium line-clamp-1"},gt={class:"updatedTime line-clamp-1"},yt={class:"mt-6 flex items-center justify-between"},xt={class:"flex w-[700px] items-center gap-4 font-mono text-gray-500"},_t={class:"flex items-center"},ht={class:"line-clamp-1"},bt=Y(()=>e("div",{class:"ml-1"},"\u9605\u8BFB",-1)),wt={key:0,class:"rounded-full bg-red-100 p-1 text-red-800"},$t={key:1,class:"rounded-full bg-gray-100 p-1 text-gray-800"},kt={class:"flex items-center gap-6 text-gray-500"},Dt=Y(()=>e("span",{class:"ml-2"},"\u7F16\u8F91",-1)),Pt={name:"PostListItem"},St=Object.assign(Pt,{props:{item:Object},setup(t){const i=t,{onEdit:l}=L("events"),v=V(()=>{const p=P(i.item.updatedAt),s=P().year();return p.year()===s?p.format("MM-DD HH:mm"):p.format("YYY-MM-DD HH:mm")}),b=i.item.publishDate&&P(i.item.publishDate).format("YYYY-MM-DD HH:mm"),o=j();function g(p){o.value&&(o.value.style.display="block")}function u(p){o.value&&(o.value.style.display="none")}return(p,s)=>(_(),$("div",dt,[e("div",ut,[e("div",mt,[e("div",pt,[e("div",ft,x(t.item.category.name),1),e("div",vt,x(t.item.title),1)]),e("div",{onMouseenter:s[0]||(s[0]=n=>g()),onMouseleave:s[1]||(s[1]=n=>u()),class:"timestamp relative text-gray-500"},[t.item.publishDate?(_(),$("div",{key:0,ref_key:"publishDateRef",ref:o,class:"publishDate absolute left-[-36px] top-[-32px] w-48 rounded bg-black p-[2px] text-center text-sm text-white opacity-75 transition transition-all duration-1000 line-clamp-1"}," \u53D1\u5E03\u4E8E "+x(a(b)),513)):S("",!0),e("div",gt,"\u7F16\u8F91\u4E8E "+x(a(v)),1)],32)]),e("div",yt,[e("div",xt,[e("div",_t,[e("div",ht,x(t.item.views),1),bt]),t.item.top?(_(),$("div",wt,[d(a(M),{icon:"up-to-line"})])):S("",!0),t.item.status===0?(_(),$("div",$t,[d(a(M),{icon:"eye-slash"})])):S("",!0)]),e("div",kt,[e("button",{onClick:s[2]||(s[2]=n=>a(l)(t.item)),class:"flex items-center rounded border px-3 py-[6px] hover:bg-gray-50"},[d(a(M),{icon:"pen"}),Dt]),d(a(ct),{item:t.item},null,8,["item"])])])])]))}});var Mt=R(St,[["__scopeId","data-v-19fe9c72"]]);const Tt={class:"text-gray-600"},jt={class:"post-list"},Ct={class:"flex h-20 items-center justify-center"},Lt={name:"AllPosts"},At=Object.assign(Lt,{setup(t){const{pagination:i,postList:l,fetchPostList:v,deletePost:b,setPostTop:o,setPostStatus:g}=tt(),u=C(),p=J(),s=y=>{p.push(`/post/edit/${y.id}`)},n=async y=>{u.show({title:"\u786E\u5B9A\u5220\u9664\uFF1F",message:"\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500",showCancel:!0,onEnter:async()=>{const{error:m,msg:k}=await b(y.id);m||await v()}})},r=async y=>{try{const{error:m,msg:k}=await o({id:y.id,top:!y.top});if(m)return;await v()}catch(m){console.log(m)}},c=async y=>{try{const{error:m,msg:k}=await g({id:y.id,status:y.status===0?1:0});if(m)return;await v()}catch(m){console.log(m)}},f=()=>{window.scrollTo(0,0)};return K("events",{onEdit:s,onDelete:n,onSetTop:r,onSetStatus:c}),G(async()=>{await v()}),(y,m)=>{const k=z("a-pagination");return _(),$("div",null,[e("div",Tt,"\u5171 "+x(a(i).total)+" \u6761\u5185\u5BB9",1),e("div",jt,[(_(!0),$(Z,null,q(a(l),w=>(_(),I(a(Mt),{key:w.id,item:w,class:"post-item-container border-b"},null,8,["item"]))),128))]),e("div",Ct,[d(k,{current:a(i).page,"onUpdate:current":m[0]||(m[0]=w=>a(i).page=w),pageSize:a(i).size,"onUpdate:pageSize":m[1]||(m[1]=w=>a(i).size=w),total:a(i).total,"hide-on-single-page":"",onChange:f},null,8,["current","pageSize","total"])])])}}});export{At as default};
