import{h as j,r as V,w as B,a as v,o as c,c as p,b as r,t as b,d as q,m as D,e as k,n as N,_ as O,u as P,f as g,g as I,i as o,j as $,M as h,p as A,k as z,l as G}from"./index.a364b306.js";import{t as R,a as H,b as J}from"./index.768229a8.js";function K(s,e){return j.request({method:"get",url:"/captcha/img",params:{width:s,height:e}})}function Q(s){return j.request({method:"post",url:"/login",data:s})}const W={form:{valid:!0,msg:""},username:{valid:!0,msg:""},password:{valid:!0,msg:""},verifyCode:{valid:!0,msg:""}},X={username:"",password:"",captchaId:"",verifyCode:""};function Y(){let s=V(X),e=V(W);function l(){Object.keys(e).forEach(t=>{e[t].valid=!0,e[t].msg=""})}function n(){if(!s.username.trim()){e.username.valid=!1,e.username.msg="\u8BF7\u8F93\u5165\u7528\u6237\u540D",e.form.valid=!1;return}if(!R(s.username)){e.username.valid=!1,e.username.msg="\u7528\u6237\u540D\u683C\u5F0F\u4E0D\u6B63\u786E",e.form.valid=!1;return}if(!s.password.trim()){e.password.valid=!1,e.password.msg="\u8BF7\u8F93\u5165\u5BC6\u7801",e.form.valid=!1;return}if(!H(s.password)){e.password.valid=!1,e.password.msg="\u5BC6\u7801\u683C\u5F0F\u4E0D\u6B63\u786E",e.form.valid=!1;return}if(!s.verifyCode.trim()){e.verifyCode.valid=!1,e.verifyCode.msg="\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",e.form.valid=!1;return}if(!J(s.verifyCode)){e.verifyCode.valid=!1,e.verifyCode.msg="\u9A8C\u8BC1\u7801\u683C\u5F0F\u9519\u8BEF",e.form.valid=!1;return}l()}async function a(){const t={};try{const i=await Q(s);t.data=i.data}catch(i){t.error=!0,t.msg=i.msg,t.code=i.code}return t}return B(()=>{const t=window.localStorage.getItem("login-username");t&&(s.username=t)}),{loginState:s,login:a,validate:n,resetValidation:l,validationState:e}}function Z(){const s=V({img:"",id:""});async function e(){try{const n=await K(120,60);if(n.success){const a=n.data;s.id=a.id,s.img=a.img}}catch{}}function l(n){const a=v(!0),t=v(n);return{ready:a,countDown:t,start:f=>{if(!!a.value&&(f(),a.value=!1,t.value>0)){const w=setInterval(()=>{t.value--,t.value<=0&&(a.value=!0,t.value=n,clearInterval(w))},1e3)}}}}return B(async()=>{await e()}),{captcha:s,getCaptcha:e,useTimeout:l}}const ee={class:"flex flex-col bg-white"},te={class:"p-1 text-xs text-gray-500"},se=["value","type"],ae={class:"flex h-5 w-5 items-center justify-center text-green-500"},oe={key:0,name:"checkmark-sharp"},re={key:0,class:"h-6 p-1 text-sm text-red-500 line-clamp-1"},ne={name:"LoginInput"},C=Object.assign(ne,{props:{label:{type:String,required:!0},valid:{type:Boolean,default:!1},type:{type:String,default:"text"},modelValue:String,errorMsg:String,useMsg:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(s,{emit:e}){const l=v(!1);function n(a){let t=a.target.value;e("update:modelValue",t)}return(a,t)=>(c(),p("div",ee,[r("label",te,b(s.label),1),r("label",{class:N(["flex items-center justify-around gap-2 border-b-2 px-2 transition",{"border-b-blue-900":l.value}])},[q(a.$slots,"left-icon"),r("input",D({value:s.modelValue,onInput:n,type:s.type},a.$attrs,{onFocus:t[0]||(t[0]=i=>l.value=!0),onBlur:t[1]||(t[1]=i=>l.value=!1),class:"flex-1 rounded-md border-none outline-none focus:border-none focus:shadow-none focus:outline-none focus:ring-0"}),null,16,se),r("span",ae,[s.valid?(c(),p("ion-icon",oe)):k("",!0)])],2),s.useMsg?(c(),p("label",re,b(s.errorMsg),1)):k("",!0)]))}});const le=s=>(A("data-v-4d71853b"),s=s(),z(),s),ie={class:"login-container h-full bg-white bg-login bg-cover bg-center"},ue={class:"mx-auto flex h-full items-center justify-center lg:container"},de={class:"login-panel flex w-[400px] flex-col overflow-hidden rounded-2xl shadow-md"},ce=le(()=>r("div",{class:"bg-gradient-to-r from-gray-500 to-gray-900 py-8 text-center text-white"},[r("h1",{class:"text-3xl"},"\u535A\u5BA2\u7BA1\u7406"),r("p",null,"sunmoon")],-1)),fe={class:"bg-white px-5 py-10 pb-20"},me={class:"space-y-4 rounded-lg"},ge={class:"flex items-center justify-between gap-1"},pe=["src"],ve=["disabled"],ye={key:1,class:"text-base text-gray-400"},he=["disabled"],be={name:"LoginPage"},we=Object.assign(be,{setup(s){const{captcha:e,getCaptcha:l,useTimeout:n}=Z(),{loginState:a,validationState:t,login:i,resetValidation:f,validate:w}=Y(),{ready:_,countDown:F,start:M}=n(10),y=v(!1),x=v("\u767B \u5F55");x.value="\u767B \u5F55";const U=G(),E=P();function L(d,u){switch(d){case 10002:t.verifyCode.msg=u;break;case 10003:t.username.msg=u;break;default:t.username.msg="\u767B\u5F55\u5931\u8D25"}}const T=async()=>{try{if(y.value=!0,w(),!t.form.valid)return;a.captchaId=e.id;const d=await i();if(d.error){L(d.code,d.msg);return}x.value="\u767B\u5F55\u6210\u529F",E.setToken(d.data.token),a.password="",a.verifyCode="",window.localStorage.setItem("login-username",a.username),await U.push("/")}catch{}finally{y.value=!1}},S=()=>{!_.value||M(l)};return(d,u)=>(c(),p("div",ie,[r("div",ue,[r("div",de,[ce,r("div",fe,[r("div",me,[g(o(C),{label:"\u7528\u6237\u540D",modelValue:o(a).username,"onUpdate:modelValue":u[0]||(u[0]=m=>o(a).username=m),onFocus:o(f),"error-msg":o(t).username.msg,class:"text-lg"},{"left-icon":I(()=>[g(o(h),{icon:"user"})]),_:1},8,["modelValue","onFocus","error-msg"]),g(o(C),{label:"\u5BC6\u7801",type:"password",modelValue:o(a).password,"onUpdate:modelValue":u[1]||(u[1]=m=>o(a).password=m),onFocus:o(f),"error-msg":o(t).password.msg,class:"text-lg"},{"left-icon":I(()=>[g(o(h),{icon:"key"})]),_:1},8,["modelValue","onFocus","error-msg"]),r("div",ge,[g(o(C),{modelValue:o(a).verifyCode,"onUpdate:modelValue":u[2]||(u[2]=m=>o(a).verifyCode=m),label:"\u56FE\u7247\u9A8C\u8BC1\u7801",onFocus:o(f),"error-msg":o(t).verifyCode.msg,class:"w-0 flex-grow"},null,8,["modelValue","onFocus","error-msg"]),r("img",{src:o(e).img,alt:"\u56FE\u7247\u9A8C\u8BC1\u7801",onClick:S,class:"mb-[21px] h-[60px] w-[120px] flex-none cursor-pointer"},null,8,pe),r("button",{onClick:S,disabled:!o(_),class:"flex w-8 cursor-pointer items-center justify-center text-lg"},[o(_)?(c(),$(o(h),{key:0,icon:"arrow-rotate-right"})):(c(),p("span",ye,b(o(F)),1))],8,ve)]),r("button",{class:"flex w-full items-center justify-center gap-3 rounded-lg bg-blue-500 p-2 text-white transition hover:bg-blue-600 disabled:bg-blue-400",onClick:T,disabled:y.value},[y.value?(c(),$(o(h),{key:0,icon:"spinner-third",class:"animate-spin"})):k("",!0),r("span",null,b(x.value),1)],8,he)])])])])]))}});var Ce=O(we,[["__scopeId","data-v-4d71853b"]]);export{Ce as default};
